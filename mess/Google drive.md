**Интерфейс - это физический компонент (дай потрогать) (#порт подключения) + компонент стандартный.

Устройства ввода-вывода делятся на два типа: блок-ориентированные устройства и байт-ориентированные устройства.

Блок-ориентированные устройства хранят информацию в блоках фиксированного размера, каждый из которых имеет свой собственный адрес (например диск). Байт-ориентированные устройства не адресуемы и не позволяют производить операцию поиска, они генерируют или потребляют последовательность байтов(строчные принтеры, сетевые адаптеры)

Однако некоторые внешние устройства не относятся ни к одному классу, например, часы, которые, с одной стороны, не адресуемы, а с другой стороны, не порождают потока байтов. Это устройство только выдает сигнал прерывания в некоторые моменты времени.

==Память тоже относится к классу устройств ввода-вывода.==
Когда подключается устройство, включается 3 шины:
-   Шина адресная
-   Шина данных
-   Шина управления
    5

Внешнее устройство обычно состоит из механического(само устройство) и электронного компонента (контроллер устройства(или по другому адаптер)). 

Некоторые контроллеры могут управлять несколькими устройствами

Операционная система обычно имеет дело не с устройством, а с контроллером. Контроллер выполняет простые функции, например, преобразует поток бит в блоки, состоящие из байт, и осуществляют контроль и исправление ошибок. Каждый контроллер имеет несколько регистров, которые используются для взаимодействия с центральным процессором. 

Контроллер нужен для упрощения работы ОС с устройствами.

Введение контроллеров - это еще один уровень абстракции.

ОС выполняет ввод-вывод, записывая команды в регистры контроллера. Когда команда принята, процессор оставляет контроллер и занимается другой работой. При завершении команды контроллер организует прерывание для того, чтобы передать управление процессором операционной системе, которая должна проверить результаты операции. Процессор получает результаты и статус устройства, читая информацию из регистров контроллера.

Происходит технический опрос устройства ввода-вывода:

1.  Чтение информации на регистр состояния (устройство занято/свободно)
2.  Записывается код команды ввода-вывода в код регистра управления
3.  Процессор записывает данные в регистр выходных данных
4.  Отметка что устройство занято
5.  Контроллер принимает данные
6.  Сбрасывается состояние занятости 
7.  Сбрасывается состояние ошибки


Пять уровней ввода-вывода:
1.  Аппаратура
2.  Обработчики прерываний
3.  Драйверы устройств
4.  Независимое от устройств ПО ОС
5.  Пользовательский слой ПО
    

Обработка прерываний

Прерывания должны быть скрыты как можно глубже в недрах операционной системы, чтобы как можно меньшая часть ОС имела с ними дело. Наилучший способ состоит в разрешении процессу, инициировавшему операцию ввода-вывода, блокировать себя до завершения операции и наступления прерывания. (Проще говоря лучше блокировать драйвер ввода-вывода)

Алгоритм:
1.  Драйвер начинает операцию ввода-вывод
2.  Драйвер блокирует сам себя
3.  Происходит прерывание
4.  Обработчик прерываний начинает работу
5.  Обработчик прерываний может разблокировать драйвер
    

Обработчик прерываний – программа обработки прерывания, являющаяся частью ОС, предназначенная для выполнения ответных действий на условие, вызвавшее прерывание.

Хороший сайт про прерывания (может быть может быть): [Обработка прерываний, векторы прерываний, программные прерывания, IRQ.](http://more-it.ru/obrabotka-preryvanij-vektory-preryvanij-programmnye-preryvaniya-irq/) 

Буферизация

Буферизация - метод организации обмена, в частности, ввода и вывода данных в компьютерах и других вычислительных устройствах, который подразумевает использование буфера для временного хранения данных.

Рассмотрим несколько примеров буферизации:

![](https://lh4.googleusercontent.com/fFmsH2r14pyQsApPJzvyOF56Og37F37_Ikvfz0O2S_ZRuA5ku2ZmO42AN3MSd9ftump7Tj_PH6xYC0e15AsuJWPt54aKtCPAMCpFtSgYGIhb-wqW35_I-k4kRTX_1GyAho0qgnl6jriCC9MszPhLX4zBX_9xLBCUNPVT12zyzBpDg3PDclH9zakn)

a) Небуферизованный ввод - после ввода каждого символа происходит прерывание

b) Буферизация в пространстве пользователя - приходится держать загруженными необходимые страницы памяти в физической памяти.

c) Буферизация в ядре с копированием в пространство пользователя - страница загружается только когда буфер ядра полный, данные из буфера ядра в буфер пользователя копируется за одну операцию. Проблема может возникнуть, когда буфер ядра полный, а страница буфера пользователя еще не загружена.

d) Двойная буферизация в ядре - если один буфер заполнен, и пока он выгружается, символы пишутся во второй буфер.

Программное обеспечение ввода-вывода пространства пользователя

Функции:

-   Обращение к системным вызовам ввода-вывода (через библиотечные процедуры).
-   Форматный ввод-вывод (меняют формат, например, в ASCII)
-   Спулинг (для выделенных устройств) - создается процесс (например, демон печати) и каталог спулера.
    

Базовая подсистема ввода-вывода служит посредником между процессами вычислительной системы и набором драйверов. Системные вызовы для выполнения операций ввода-вывода трансформируются ею в вызовы функций необходимого драйвера устройства. Однако обязанности базовой подсистемы не сводятся к выполнению только действий трансляции общего системного вызова в обращение к частной функции драйвера. Базовая подсистема предоставляет вычислительной системе такие услуги, как поддержка блокирующихся, неблокирующихся и асинхронных системных вызовов, буферизация и кэширование входных и выходных данных, осуществление spooling'a и монопольного захвата внешних устройств, обработка ошибок и прерываний, возникающих при операциях ввода-вывода, планирование последовательности запросов на выполнение этих операций. 

Системные вызовы:

-   Блокирующие системные вызовы - процесс, который инициирует работу с устройством переводится в состояние ожидания.
-   Неблокирующие системные вызовы - процесс, который инициирует работу с устройством не переводится в состояние ожидания. Нужны для такого типа устройств, где не требуется много информации (мышь, клавиатура)
-   Асинхронные системные вызовы - процесс, использовавший асинхронный системный вызов, никогда в нем не блокируется. Системный вызов инициирует выполнение необходимых операций ввода-вывода и немедленно возвращается, после чего процесс продолжает свою регулярную деятельность. (сервер печати MS Windows) 
    

Буферизация и кэширование

Существуют три причины, приводящие к использованию буферов:

1.  Разные скорости приема и передачи информации, которыми обладают участники обмена.
2.  Разные объемы данных, которые могут быть приняты или получены участниками обмена единовременно.
3.  Необходимость копирования информации из приложений, осуществляющих ввод-вывод, в буфер ядра операционной системы и обратно.
    

Под словом кэш, обычно понимают область быстрой памяти, содержащую копию данных, расположенных где-либо в более медленной памяти, предназначенную для ускорения работы вычислительной системы. В базовой подсистеме ввода-вывода не следует смешивать два понятия, буферизацию и кэширование, хотя зачастую для выполнения этих функций отводится одна и та же область памяти. Буфер часто содержит единственный набор данных, существующий в системе, в то время как кэш по определению содержит копию данных, существующих где-нибудь еще. Например, буфер, используемый базовой подсистемой для копирования данных из пользовательского пространства процесса при выводе на диск, может в свою очередь применяться как кэш для этих данных, если операции модификации и повторного чтения данного блока выполняются достаточно часто.

Функции буферизации и кэширования не обязательно должны быть локализованы в базовой подсистеме ввода-вывода. Они могут быть частично реализованы в драйверах и даже в контроллерах устройств, скрытно по отношению к базовой подсистеме.